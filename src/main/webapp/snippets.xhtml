<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1
/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<ui:composition template="/templates/template.xhtml">
		<ui:define name="content">
		
			<script type="text/javascript">
			function decode(data) {
				//var find = '|newline|';
				//var re = new RegExp(find, 'g');
				//data = data.replace(re, '\n');
				return data;
			}
			
			function showSnippet(id, title, icon) {
				const userAction = async () => {
					  const response = await fetch('http://localhost:8080/rest/articles/getArticle?articleId=' + id);
					  const myJson = await response.json(); //extract JSON from the http response
					  $('#snippet-body').html(myJson.body);
					  $('#snippet-title').html(title);
					  $('#snippet-image').attr("src", "data:image/png;base64," + icon);
					  $('#snippet-pop').fadeIn('slow');
					 
				}

				userAction();
			}
			</script>
		
			<div id="snippet-pop" class="snippet-popup" style="display:none">
				<div id="snippet-title" style="height:30px; width:600px;background-color: #eee;"/>
				<div id="snippet-body" style="height:200px; width:600px;background-color: #ddd;"/>
				<div style="width:200px;height:200px;position: absolute;top: 10px;right: 10px;">
					<img id="snippet-image" class="snippet-image" src=""/>
				</div>
			</div>
		
			<div class="snippet-container" style="text-align: center">
				<div class="article-container">
					<br/>
					<ui:repeat id="showArticles" var="article"
						value="#{articleController.allSnippets}">
						<div class="snippet-card"  
							onclick="showSnippet('#{article.id}', '#{article.title}', '#{article.icon}');">
							<div class="top-section">
								<div class="snippet-circular-border">
									<h:graphicImage value="data:image/png;base64,#{article.icon}"
										class="snippet-graphic" />
								</div>
								<div class="snippet-text"><h:outputText value="#{article.title}"/></div>
							</div>
							<svg class="snippet-svg-background" viewBox="0 0 1600 600"> 
								<path class="blob" d="#{blobController.randomBlob}"/>
							</svg>
						</div>
					</ui:repeat>
				</div>
			</div>
				
			<div class="snippet-card active" style="valign:top;display:none"/>

			<script type="text/javascript">
			function handleMouseover(e) {
				document.querySelector(".active").classList.remove("active");
			    e.target.closest(".snippet-card").classList.add("active");
			}
			document.querySelectorAll(".snippet-card").forEach(card => card.addEventListener("mouseover", handleMouseover) );
		 	</script>
		</ui:define>
	</ui:composition>

</html>